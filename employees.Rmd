---
title: "employee.csv"
output: html_document
date: "2024-04-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

Nos conectamos al dataset:
Columns:

Education: The educational qualifications of employees, including degree, institution, and field of study.

Joining Year: The year each employee joined the company, indicating their length of service.

City: The location or city where each employee is based or works.

Payment Tier: Categorization of employees into different salary tiers.

Age: The age of each employee, providing demographic insights.

Gender: Gender identity of employees, promoting diversity analysis.

Ever Benched: Indicates if an employee has ever been temporarily without assigned work.

Experience in Current Domain: The number of years of experience employees have in their current field.

Leave or Not: a target column

```{r}
url <- "https://raw.githubusercontent.com/chelocoder/ProyectoR/main/Employee.csv"
datos <- read.csv(url)
head(datos)
```
```{r count-missing-data, results='markup'}
# Conteo de datos faltantes en cada columna
missing_data_counts <- sapply(datos, function(x) sum(is.na(x)))

# Mostrando el conteo de datos faltantes
missing_data_counts

```


```{r}
summary(datos)
```


```{r}
# Identificando variables numéricas
numeric_vars <- sapply(datos, function(x) is.numeric(x) || is.integer(x))
numeric_variables <- names(datos)[numeric_vars]

# Identificando variables categóricas
categorical_vars <- sapply(datos, function(x) is.factor(x) || is.character(x) || is.logical(x))
categorical_variables <- names(datos)[categorical_vars]

# Mostrando las variables numéricas y categóricas
list(numeric = numeric_variables, categorical = categorical_variables)
```
```{r barplot-joining-year-ggplot, fig.cap="Gráfico de Barras de JoiningYear con ggplot2"}
# Cargar la librería ggplot2
library(ggplot2)

# Crear un data frame con los conteos de cada año
joining_year_data <- as.data.frame(table(datos$JoiningYear))

# Crear el gráfico de barras usando ggplot2
ggplot(joining_year_data, aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  ggtitle("Gráfico de Barras de JoiningYear") +
  xlab("Año de Ingreso") +
  ylab("Frecuencia")
```
```{r barplot-paymenttier-ggplot, fig.cap="Gráfico de Barras de PaymentTier con ggplot2"}
# Cargar la librería ggplot2
library(ggplot2)

# Crear un data frame con los conteos de cada categoría de PaymentTier
payment_tier_data <- as.data.frame(table(datos$PaymentTier))

# Crear el gráfico de barras usando ggplot2
ggplot(payment_tier_data, aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "coral") +
  ggtitle("Gráfico de Barras de PaymentTier") +
  xlab("Tier de Pago") +
  ylab("Frecuencia")

```


```{r histogram-age-ggplot, fig.cap="Histograma de Age con ggplot2"}
# Cargar la librería ggplot2
library(ggplot2)

# Crear un histograma usando ggplot2
ggplot(datos, aes(x = Age)) +
  geom_histogram(binwidth = 1, fill="blue", color="black") +
  ggtitle("Histograma de Age") +
  xlab("Edad") +
  ylab("Frecuencia")

```
```{r boxplot-age-ggplot, fig.cap="Box Plot de Age con ggplot2"}
# Cargar la librería ggplot2
library(ggplot2)

# Creando un box plot usando ggplot2
ggplot(datos, aes(y = Age)) +
  geom_boxplot(fill = "lightgreen") +
  ggtitle("Box Plot de Age") +
  ylab("Edad")

```


```{r barplot-experience-ggplot, fig.cap="Gráfico de Barras de ExperienceInCurrentDomain con ggplot2"}
# Cargar la librería ggplot2
library(ggplot2)

# Crear un data frame con los conteos de cada valor de ExperienceInCurrentDomain
experience_data <- as.data.frame(table(datos$ExperienceInCurrentDomain))

# Crear el gráfico de barras usando ggplot2
ggplot(experience_data, aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  ggtitle("Gráfico de Barras de ExperienceInCurrentDomain") +
  xlab("Años de Experiencia en el Dominio Actual") +
  ylab("Frecuencia")

```
```{r barplot-leaveornot-ggplot, fig.cap="Gráfico de Barras de LeaveOrNot con ggplot2"}
# Cargar la librería ggplot2
library(ggplot2)

# Crear un data frame con los conteos de cada categoría de LeaveOrNot
leave_data <- as.data.frame(table(datos$LeaveOrNot))

# Crear el gráfico de barras usando ggplot2
ggplot(leave_data, aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "salmon") +
  ggtitle("Gráfico de Barras de LeaveOrNot") +
  xlab("Decisión") +
  ylab("Frecuencia")

```


```{r}
# Identifying character variables
char_vars <- sapply(datos, class) == "character"

# Extracting unique values for each character variable
unique_values <- lapply(datos[, char_vars, drop = FALSE], unique)

# Displaying the unique values
unique_values

```
```{r barplot-education-ggplot, fig.cap="Gráfico de Barras de Education con ggplot2"}
# Cargar la librería ggplot2
library(ggplot2)

# Crear un data frame con los conteos de cada categoría de Education
education_data <- as.data.frame(table(datos$Education))

# Crear el gráfico de barras usando ggplot2
ggplot(education_data, aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "turquoise") +
  ggtitle("Gráfico de Barras de Education") +
  xlab("Nivel de Educación") +
  ylab("Frecuencia")

```
```{r barplot-city-ggplot, fig.cap="Gráfico de Barras de City con ggplot2"}
# Cargar la librería ggplot2
library(ggplot2)

# Crear un data frame con los conteos de cada ciudad
city_data <- as.data.frame(table(datos$City))

# Crear el gráfico de barras usando ggplot2
ggplot(city_data, aes(x = reorder(Var1, -Freq), y = Freq)) +
  geom_bar(stat = "identity", fill = "cadetblue") +
  ggtitle("Gráfico de Barras de City") +
  xlab("Ciudad") +
  ylab("Frecuencia") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Rotating x-axis labels for better visibility

```

```{r barplot-gender-ggplot, fig.cap="Gráfico de Barras de Gender con ggplot2"}
# Cargar la librería ggplot2
library(ggplot2)

# Crear un data frame con los conteos de cada género
gender_data <- as.data.frame(table(datos$Gender))

# Crear el gráfico de barras usando ggplot2
ggplot(gender_data, aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "orchid") +
  ggtitle("Gráfico de Barras de Gender") +
  xlab("Género") +
  ylab("Frecuencia")

```
```{r barplot-everbenched-ggplot, fig.cap="Gráfico de Barras de EverBenched con ggplot2"}
# Cargar la librería ggplot2
library(ggplot2)

# Crear un data frame con los conteos de cada categoría de EverBenched
everbenched_data <- as.data.frame(table(datos$EverBenched))

# Crear el gráfico de barras usando ggplot2
ggplot(everbenched_data, aes(x = Var1, y = Freq)) +
  geom_bar(stat = "identity", fill = "lightcoral") +
  ggtitle("Gráfico de Barras de EverBenched") +
  xlab("Ha Sido Bencheado") +
  ylab("Frecuencia")

```
```{r include=FALSE}
# Install GGally if it's not already installed
if (!require("GGally")) install.packages("GGally", dependencies = TRUE)

# Load the necessary libraries
library(ggplot2)
library(GGally)


```

```{r convert-factors}
# Converting 'LeaveOrNot' to a factor if it's not already
datos$LeaveOrNot <- as.factor(datos$LeaveOrNot)
# Optionally, convert other categorical variables
datos$PaymentTier <- as.factor(datos$PaymentTier)

# Now, subset the dataset with the required variables
selected_variables <- datos[, c("Age", "JoiningYear", "ExperienceInCurrentDomain", "PaymentTier", "LeaveOrNot")]
```
```{r setup-libraries, include=FALSE}
# Install corrplot if it's not already installed
if (!require("corrplot")) install.packages("corrplot", dependencies = TRUE)

# Load the library
library(corrplot)

```

```{r pairplot-leaveornot-fixed, fig.cap="Pairplot with LeaveOrNot as Hue"}
# Creating the pairplot using GGally
library(GGally)
ggpairs(selected_variables, aes(color = LeaveOrNot), 
        lower = list(continuous = wrap("points", alpha = 0.5, size = 1)),
        diag = list(continuous = wrap("barDiag")),
        upper = list(continuous = wrap("cor", size = 3)),
        title = "Pairplot with LeaveOrNot as Hue")

```


```{r compute-correlation, results='markup'}
# Subsetting the dataset to include only numerical variables
numerical_data <- datos[sapply(datos, is.numeric)]

# Calculating the correlation matrix
cor_matrix <- cor(numerical_data, use="pairwise.complete.obs")  # Handling missing values by considering complete cases

# Display the correlation matrix
cor_matrix

```
```{r visualize-correlation, fig.cap="Correlation Matrix Visualization"}
# Visualizing the correlation matrix
corrplot(cor_matrix, method="circle", type="upper", order="hclust",
         tl.col="black", tl.srt=45)  # Rotate labels for better readability
```


```{r}
###### ESTADISTICOS INFERENCIALES
# VER RELACIONES ENTRE VARIABLES NUMERICAS (JOINING YEAR, AGE, EXPERIENCE IN CURRENT DOMAIN, PAYMENT TIER) Y TARGET (LEAVE OR NOT) CON UN MAPA DE CALOR

library(ggplot2)
library(reshape2)

# CARGALOS LOS DATOS
df <- Employee
df

# CALCULAMOS LA MATRIZ DE CORRELACION

cor_matrix <- cor(df[, sapply(df, is.numeric)])
cor_matrix

# VISUALIZAMOS LA MATRIZ DE CORRELACION
hot_matrix <- melt(cor_matrix)

ggplot(hot_matrix, aes(Var1, Var2, fill=value)) + 
  geom_tile(color="white") +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint=0, limit=c(-1,1), space="Lab", 
                       name="Pearson\nCorrelation") +
  geom_text(aes(Var1, Var2, label = round(value, 2)), color = "black", size = 3) +
  theme_minimal()+ 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, 
                                   size = 12, hjust = 1)) +
  coord_fixed()

## La matriz de correlación muestra las siguientes relaciones entre las variables numéricas:
## La correlación entre las variables no muestra relaciones fuertemente lineales. La mayoría de los coeficientes son cercanos a cero, indicando poca o ninguna correlación lineal.
## La variable LeaveOrNot tiene una correlación positiva de 0.18 con JoiningYear (año de ingreso), lo que podria indicar que mientras más tiempo lleva un empleado en la empresa, es más probable que decida no dejarla. 
## La varibale LeaveOrNot tiene una relacion negativa con PaymenTier (nivel de salario) de -0.20, lo  que podría indicar que a menor salario un empleado en la emppresa, es mas probable decida dejar la empresa.
## Las otras correlaciones son relativamente bajas, sugiriendo que estas variables no están fuertemente influenciadas entre sí en términos lineales.


# REALIZAMOS UN BOX PLOT PARA VER LAS RELACIONES ENTRE LA VARIABLE EDAD Y LA VARIABLE TARGET
  geom_boxplot() + 
  scale_fill_manual(values = c("#00AFBB", "#E7B800")) +
  labs(title = "Boxplot of Age by LeaveOrNot", x = "LeaveOrNot", y = "Age") +
  theme_minimal()

# REALIZAMOS UN BOX PLOT PARA VER LAS RELACIONES ENTRE LA VARIABLE EXPERIENCIA EN EL DOMINIO ACTUAL Y LA VARIABLE TARGET 
ggplot(df, aes(x=LeaveOrNot, y=ExperienceInCurrentDomain, fill=LeaveOrNot)) + 
  geom_boxplot() + 
  scale_fill_manual(values = c("#00AFBB", "#E7B800")) +
  labs(title = "Boxplot of ExperienceInCurrentDomain by LeaveOrNot", x = "LeaveOrNot", y = "ExperienceInCurrentDomain") +
  theme_minimal()

## Edad vs. Dejar la Empresa: No parece haber una diferencia significativa en la edad de los empleados que deciden dejar la empresa y los que se quedan.
## Experiencia en el Dominio Actual vs. Dejar la Empresa: Similarmente, la experiencia en el dominio actual no muestra una diferencia clara en términos de afectar la decisión de dejar o no la empresa.

# GRAFICO DE RELACION ENTRE VARIABLES "City" VS "LeaveOrNot"
ggplot(data = df, aes(x = City, fill = factor(LeaveOrNot))) +  # Define las variables para el eje X y el color
  geom_bar(position = "dodge", stat = "count") +  # Crea barras separadas para cada grupo en LeaveOrNot
  labs(title = "Relación entre Ciudad y Dejar la Empresa",
       x = "Ciudad",
       y = "Número de Empleados",
       fill = "Dejar la Empresa") +  # Personaliza las etiquetas y título
  scale_fill_manual(values = c("#FF6666", "#6666FF"), labels = c("No", "Sí")) +  # Colores y leyendas personalizados
  theme_minimal() +  # Aplica un tema minimalista
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Ajusta el texto del eje X para mejorar la visualización

# GRAFICO DE RELACION ENTRE VARIABLES "Gender" VS "LeaveOrNot"
ggplot(data = df, aes(x = Gender, fill = factor(LeaveOrNot))) +  # Define las variables para el eje X y el color
  geom_bar(position = "dodge", stat = "count") +  # Crea barras separadas para cada grupo en LeaveOrNot
  labs(title = "Relación entre Genero y Dejar la Empresa",
       x = "Genero",
       y = "Número de Empleados",
       fill = "Dejar la Empresa") +  # Personaliza las etiquetas y título
  scale_fill_manual(values = c("#FF6666", "#6666FF"), labels = c("No", "Sí")) +  # Colores y leyendas personalizados
  theme_minimal() +  # Aplica un tema minimalista
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Ajusta el texto del eje X para mejorar la visualización

# GRAFICO DE RELACION ENTRE VARIABLES "Education" VS "LeaveOrNot"
ggplot(data = df, aes(x = Education, fill = factor(LeaveOrNot))) +  # Define las variables para el eje X y el color
  geom_bar(position = "dodge", stat = "count") +  # Crea barras separadas para cada grupo en LeaveOrNot
  labs(title = "Relación entre Nivel de Educacion y Dejar la Empresa",
       x = "Educacion",
       y = "Número de Empleados",
       fill = "Dejar la Empresa") +  # Personaliza las etiquetas y título
  scale_fill_manual(values = c("#FF6666", "#6666FF"), labels = c("No", "Sí")) +  # Colores y leyendas personalizados
  theme_minimal() +  # Aplica un tema minimalista
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Ajusta el texto del eje X para mejorar la visualización


## Los gráficos de barras muestran las siguientes tendencias en relación a la decisión de dejar la empresa:

## Ciudad:
  ## En Bangalore y Pune, una mayor proporción de empleados parece permanecer en la empresa en comparación con New Delhi.
## Género:
  ## La proporción entre hombres y mujeres que dejan la empresa parece ser bastante similar.
## Educación:
  ## Los empleados con título de "Masters" y "PHD" parecen tener una menor proporción de salida en comparación con los de "Bachelors".

## Para determinar si estas diferencias son estadísticamente significativas, procederemos a realizar pruebas de Chi-cuadrado. 
## Estas pruebas nos permitirán evaluar si las diferencias observadas en cada grupo son suficientes para sugerir una dependencia entre 
## las variables categóricas y la decisión de dejar la empresa. 

# PRUEBA DE CHI-CUADRADO PARA CIUDAD
city_table <- table(df$City, df$LeaveOrNot)
city_table
CH2_CITY <- chisq.test(city_table)

# PRUEBA DE CHI-CUADRADO PARA GENERO
city_table <- table(df$Gender, df$LeaveOrNot)
city_table
CH2_GENDER <- chisq.test(city_table)

# PRUEBA DE CHI-CUADRADO PARA EDUCACION
city_table <- table(df$Education, df$LeaveOrNot)
city_table
CH2_EDUCATION <- chisq.test(city_table)

# SHOW IN DATA FRAME THE RESULTS OF CHI-SQUARE TEST 
results <- data.frame(
  Variable = c("City", "Gender", "Education"),
  Chi_Square = c(CH2_CITY$statistic, CH2_GENDER$statistic, CH2_EDUCATION$statistic),
  P_Value = c(CH2_CITY$p.value, CH2_GENDER$p.value, CH2_EDUCATION$p.value)
)
print(results)

## RESULTADOS
## 1 Ciudad
## Chi-cuadrado: 206.16 VS P-Valor: 1.710699e-45
## 2 Género
## Chi-cuadrado: 225.6954 VS P-Valor: 5.177874e-51
## 3 Educación
## Chi-cuadrado: 101.8301 VS P-Valor: 7.724418e-23
## Dado que los valores de p son extremadamente bajos para las tres pruebas, podemos concluir que hay una asociaciónÇ
## significativa entre cada una de estas variables categóricas y la decisión de dejar la empresa. Esto indica que tanto la ciudad, 
## el género como el nivel educativo tienen un impacto en la probabilidad de que un empleado deje la empresa.
```

